(()=>{"use strict";var e={860:e=>{e.exports=require("express")},519:e=>{e.exports=require("spotify-web-api-node")},752:e=>{e.exports=require("tslib")},17:e=>{e.exports=require("path")}},r={};function t(o){var s=r[o];if(void 0!==s)return s.exports;var n=r[o]={exports:{}};return e[o](n,n.exports,t),n.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0});const r=t(752),s=(0,r.__importDefault)(t(860)),n=(0,r.__importStar)(t(17)),i=(0,r.__importDefault)(t(519)),c=(0,s.default)(),a=n.join(__dirname,"../spotivibe");c.use(s.default.static(a)),c.get("/api/callback",((e,t)=>{try{const o=new i.default({clientId:process.env.SPOTIFY_CLIENT_ID,clientSecret:process.env.SPOTIFY_CLIENT_SECRET,redirectUri:`${process.env.SPOTIFY_SERVER_URL}/api/callback/`});o.authorizationCodeGrant(e.query.code.toString(),((e,s)=>(0,r.__awaiter)(void 0,void 0,void 0,(function*(){if(e)return t.send(e).status(500);o.setAccessToken(s.body.access_token),o.setRefreshToken(s.body.refresh_token);const r=new URLSearchParams({refresh_token:s.body.refresh_token,access_token:s.body.access_token,expires_in:s.body.expires_in.toString(),scopes:s.body.scope,token_type:s.body.token_type}),n=yield o.getMe();console.log("Authenticated user: ",JSON.stringify(n.body)),t.redirect(`${process.env.SPOTIFY_REDIRECT_URL}?${r}`)}))))}catch(e){t.redirect(`${process.env.SPOTIFY_REDIRECT_URL}?error=${e}`)}})),c.get("/api/login",((e,r)=>{const t=new i.default({clientId:process.env.SPOTIFY_CLIENT_ID,clientSecret:process.env.SPOTIFY_CLIENT_SECRET,redirectUri:`${process.env.SPOTIFY_SERVER_URL}/api/callback/`}).createAuthorizeURL(["user-read-private","user-read-playback-state"],"state");r.redirect(t)}));const p=process.env.PORT||3333;c.listen(p,(()=>{console.log(process.env),console.log(`Listening at http://localhost:${p}/api`)})).on("error",console.error)})();var s=exports;for(var n in o)s[n]=o[n];o.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map