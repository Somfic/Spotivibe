import{w as Ve,g as te,b as Se,c as Ce,S as Ye,P as Je,T as Ke,a as Xe,M as Ze,d as Qe,e as ve,D as xe,W as et,E as tt,R as st,U as nt,V as ot,C as se,f as z,i as O,s as G,h as d,j as b,k as i,n as I,l as v,m as y,o as p,p as ne,q as pe,r as at,t as _e,u,v as Te,x as be,y as lt,z as oe,A as He,B as P,F as Re,G as D,H as N,I as W,J as j,K as g,L as it}from"./vendor.17c1065a.js";const rt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}};rt();class ct{constructor(){this.user=void 0,this.song=void 0,this.analysis=void 0,this.features=void 0,this.colors=void 0,this.imageUri="",this.isPlaying=!1,this.elapsed=0}}const A=Ve(new ct),ae=Ve(!1),$=new Ce,dt=2500;let Ue=Date.now(),Ee=0;async function ut(){if(!te(ae))return;let e=te(A);e=await ft(e),e.playback?.is_playing&&(e=ht(e)),A.set(e)}async function ft(e){if(Date.now()-Ee<dt)return e;Ee=Date.now();try{if(e.user==null&&(e.user=(await $.getMe()).body),e.playback=(await $.getMyCurrentPlaybackState()).body,Ue=Date.now()-e.playback.progress_ms,e.playback?.is_playing){const t=(await $.getTrack(e.playback.item.id)).body,s=te(A);e.colors=await Se.from(t?.album.images[0].url).getPalette(),e.imageUri=t?.album.images[0].url,(s.song==null||t?.id!==s.song.id)&&(e.song=t,e.analysis=(await $.getAudioAnalysisForTrack(e.playback?.item.id)).body,e.features=(await $.getAudioFeaturesForTrack(e.playback?.item.id)).body,console.log(`New song: ${t?.name} by ${t?.artists[0].name}`),console.log(e.analysis))}else e.colors=await Se.from(e.user.images[0].url).getPalette(),e.imageUri=e.user.images[0].url}catch(t){t.toString().includes("No token provided")&&ae.set(!1)}return e}function ht(e){return e.elapsed=(Date.now()-Ue)/1e3,e.analysis!=null&&(e.analysis.bar=B(e.analysis.bars,e.elapsed),e.analysis.beat=B(e.analysis.beats,e.elapsed),e.analysis.section=B(e.analysis.sections,e.elapsed),e.analysis.segment=B(e.analysis.segments,e.elapsed),e.analysis.tatum=B(e.analysis.tatums,e.elapsed)),e}function B(e,t){const s=e.filter(n=>n.start<=t),o=e[s.length-1];return o?.start&&(o.elapsed=(t-o.start)/o.duration),o}let le,C;const q=new Ye,ie=new Je(75,window.innerWidth/window.innerHeight,.1,1e3);ie.position.z=1;const ze=[],ye=new Ke,gt=await ye.loadAsync("/cloud.png");await ye.loadAsync("/cloud2.png");await ye.loadAsync("/cloud3.png");const Oe=[gt],mt=new Xe(400,400),vt=new Ze({map:Oe[Math.floor(Math.random()*Oe.length)],transparent:!0,opacity:.1}),re=800,pt=0,ce=200,Ge=100,de=100,Ie=-400;for(let e=0;e<100;e++){const t=new Qe(mt,vt);t.position.set(Math.random()*re*2-re+pt,Math.random()*ce*2-ce+Ge,Math.random()*de*2-de+Ie),t.rotation.z=Math.random()*2*Math.PI,t.material.opacity=.55,ze.push(t),q.add(t)}const ue=new ve(16711680,0);ue.position.set(200,300,-200);q.add(ue);const fe=new ve(65280,0);fe.position.set(100,0,-380);q.add(fe);const he=new ve(65280,0);he.position.set(-100,300,-100);q.add(he);const ge=new xe(255,0);ge.position.set(0,0,1);q.add(ge);const qe=()=>{requestAnimationFrame(qe);const e=te(A);e.analysis==null||e.analysis.sections==null||e.colors==null||e.colors.DarkMuted==null||(ue.color=new se(e.colors?.Muted?.hex),fe.color=new se(e.colors?.Vibrant?.hex),he.color=new se(e.colors?.LightVibrant?.hex),ge.color=new se(e.colors?.DarkVibrant?.hex),ge.intensity=Fe(e.analysis?.beat.elapsed)*.1,ue.intensity=-1/(e.analysis?.section?.loudness-2)*10,fe.intensity=-1/e.analysis?.segment?.loudness_max*100,he.intensity=Fe(e.analysis?.bar.elapsed)*.1,ze.forEach(t=>{t.rotation.z-=e.analysis?.section?.tempo*5e-6,t.position.x+=e.analysis?.section?.tempo*3e-6*-t.position.z,t.position.x>re&&(t.position.x=-re,t.position.y=Math.random()*ce*2-ce+Ge,t.position.z=Math.random()*de*2-de+Ie)}),C.render())},Fe=e=>Math.pow(e,2),Ne=()=>{le.setSize(window.innerWidth,window.innerHeight),C.setSize(window.innerWidth,window.innerHeight),ie.aspect=window.innerWidth/window.innerHeight,ie.updateProjectionMatrix()},_t=e=>{le=new et({powerPreference:"high-performance",antialias:!0,stencil:!1,depth:!0,alpha:!0,canvas:e}),le.setClearColor(0,0),C=new tt(le),C.addPass(new st(q,ie)),C.addPass(new nt(new ot(5,5),.2,2,0)),Ne(),qe()};window.addEventListener("resize",Ne);function bt(e){let t,s,o,n;return{c(){t=d("canvas"),o=b(),n=d("div"),i(t,"class",s=""+(I(e[1]?.analysis?.sections==null?"loading":"loaded")+" svelte-1dtw388")),i(n,"class","background svelte-1dtw388")},m(a,l){v(a,t,l),e[2](t),v(a,o,l),v(a,n,l)},p(a,[l]){l&2&&s!==(s=""+(I(a[1]?.analysis?.sections==null?"loading":"loaded")+" svelte-1dtw388"))&&i(t,"class",s)},i:y,o:y,d(a){a&&p(t),e[2](null),a&&p(o),a&&p(n)}}}function yt(e,t,s){let o;ne(e,A,l=>s(1,o=l));let n;pe(()=>{_t(n)});function a(l){at[l?"unshift":"push"](()=>{n=l,s(0,n)})}return[n,o,a]}class kt extends z{constructor(t){super();O(this,t,yt,bt,G,{})}}const wt="http://localhost:3333/api";function Mt(){window.location.href=`${wt}/login`}function We(){const e=new URLSearchParams(window.location.search),t=e.has("access_token"),s=e.has("refresh_token");return t&&s}function Lt(){if(!We())throw new Error("No access token or refresh token defined in the URL parameters");const e=new URLSearchParams(window.location.search),t=e.get("access_token"),s=e.get("refresh_token");$.setAccessToken(t),$.setRefreshToken(s),ae.set(!0),window.history.replaceState({},"","/")}function Pt(e){let t,s,o,n,a;return{c(){t=d("button"),s=_e(e[1]),i(t,"class",o=""+(I(e[2])+" svelte-djfqc5"))},m(l,c){v(l,t,c),u(t,s),n||(a=Te(t,"click",function(){lt(e[0])&&e[0].apply(this,arguments)}),n=!0)},p(l,[c]){e=l,c&2&&be(s,e[1]),c&4&&o!==(o=""+(I(e[2])+" svelte-djfqc5"))&&i(t,"class",o)},i:y,o:y,d(l){l&&p(t),n=!1,a()}}}function Dt(e,t,s){let{action:o}=t,{text:n}=t,{type:a}=t;return e.$$set=l=>{"action"in l&&s(0,o=l.action),"text"in l&&s(1,n=l.text),"type"in l&&s(2,a=l.type)},[o,n,a]}class At extends z{constructor(t){super();O(this,t,Dt,Pt,G,{action:0,text:1,type:2})}}function $t(e){let t,s,o,n,a,l,c;return{c(){t=d("div"),s=d("img"),i(s,"width",e[1]),i(s,"height",e[2]),oe(s.src,o=e[0])||i(s,"src",o),i(s,"class",n=""+(I(e[3]?"loaded":"")+" svelte-mdkfnt")),i(s,"alt",""),i(t,"class","image svelte-mdkfnt"),i(t,"style",a="width: "+e[1]+"px; height: "+e[2]+"px;")},m(r,f){v(r,t,f),u(t,s),l||(c=Te(s,"load",e[4]),l=!0)},p(r,[f]){f&2&&i(s,"width",r[1]),f&4&&i(s,"height",r[2]),f&1&&!oe(s.src,o=r[0])&&i(s,"src",o),f&8&&n!==(n=""+(I(r[3]?"loaded":"")+" svelte-mdkfnt"))&&i(s,"class",n),f&6&&a!==(a="width: "+r[1]+"px; height: "+r[2]+"px;")&&i(t,"style",a)},i:y,o:y,d(r){r&&p(t),l=!1,c()}}}function Vt(e,t,s){let{source:o}=t,{width:n}=t,{height:a}=t,l=!1;function c(){s(3,l=!0)}return e.$$set=r=>{"source"in r&&s(0,o=r.source),"width"in r&&s(1,n=r.width),"height"in r&&s(2,a=r.height)},[o,n,a,l,c]}class St extends z{constructor(t){super();O(this,t,Vt,$t,G,{source:0,width:1,height:2})}}function je(e,t,s){const o=e.slice();return o[1]=t[s],o[3]=s,o}function Tt(e){let t,s,o,n,a;return s=new St({props:{source:e[0].imageUri,width:400,height:400}}),{c(){t=d("div"),N(s.$$.fragment),o=b(),n=d("h2"),n.textContent="You're currently not playing any music",i(n,"class","svelte-bn9rh4"),i(t,"class","no-music svelte-bn9rh4")},m(l,c){v(l,t,c),W(s,t,null),u(t,o),u(t,n),a=!0},p(l,c){const r={};c&1&&(r.source=l[0].imageUri),s.$set(r)},i(l){a||(D(s.$$.fragment,l),a=!0)},o(l){P(s.$$.fragment,l),a=!1},d(l){l&&p(t),j(s)}}}function Ht(e){let t,s,o,n,a,l,c,r,f=e[0].song?.name+"",m,L,Y,J=e[0].song?.artists[0].name+"",me,ke,F,we,k,V,K,Me,S,X,Le,T,Z,Pe,H,Q,De,R,x,Ae,U,ee,E=Array(e[0]?.analysis?.sections?.length),w=[];for(let h=0;h<E.length;h+=1)w[h]=Be(je(e,E,h));return{c(){t=d("div"),s=d("div"),o=d("img"),l=b(),c=d("div"),r=d("h1"),m=_e(f),L=b(),Y=d("h2"),me=_e(J),ke=b(),F=d("div");for(let h=0;h<w.length;h+=1)w[h].c();we=b(),k=d("div"),V=d("div"),K=d("h1"),K.textContent="Light Muted",Me=b(),S=d("div"),X=d("h1"),X.textContent="Muted",Le=b(),T=d("div"),Z=d("h1"),Z.textContent="Dark Muted",Pe=b(),H=d("div"),Q=d("h1"),Q.textContent="Light Vibrant",De=b(),R=d("div"),x=d("h1"),x.textContent="Vibrant",Ae=b(),U=d("div"),ee=d("h1"),ee.textContent="Dark Vibrant",oe(o.src,n=e[0].imageUri)||i(o,"src",n),i(o,"alt",a=e[0].song?.name),i(o,"class","svelte-bn9rh4"),i(r,"class","fat svelte-bn9rh4"),i(Y,"class","svelte-bn9rh4"),i(F,"class","progress-bar svelte-bn9rh4"),i(c,"class","song svelte-bn9rh4"),i(s,"class","playback svelte-bn9rh4"),i(K,"class","svelte-bn9rh4"),i(V,"class","color svelte-bn9rh4"),g(V,"background-color",e[0].colors?.LightMuted.hex),i(X,"class","svelte-bn9rh4"),i(S,"class","color svelte-bn9rh4"),g(S,"background-color",e[0].colors?.Muted.hex),i(Z,"class","svelte-bn9rh4"),i(T,"class","color svelte-bn9rh4"),g(T,"background-color",e[0].colors?.DarkMuted.hex),i(Q,"class","svelte-bn9rh4"),i(H,"class","color svelte-bn9rh4"),g(H,"background-color",e[0].colors?.LightVibrant.hex),i(x,"class","svelte-bn9rh4"),i(R,"class","color svelte-bn9rh4"),g(R,"background-color",e[0].colors?.Vibrant.hex),i(ee,"class","svelte-bn9rh4"),i(U,"class","color svelte-bn9rh4"),g(U,"background-color",e[0].colors?.DarkVibrant.hex),i(k,"class","colors svelte-bn9rh4"),i(t,"class","music svelte-bn9rh4")},m(h,M){v(h,t,M),u(t,s),u(s,o),u(s,l),u(s,c),u(c,r),u(r,m),u(c,L),u(c,Y),u(Y,me),u(c,ke),u(c,F);for(let _=0;_<w.length;_+=1)w[_].m(F,null);u(t,we),u(t,k),u(k,V),u(V,K),u(k,Me),u(k,S),u(S,X),u(k,Le),u(k,T),u(T,Z),u(k,Pe),u(k,H),u(H,Q),u(k,De),u(k,R),u(R,x),u(k,Ae),u(k,U),u(U,ee)},p(h,M){if(M&1&&!oe(o.src,n=h[0].imageUri)&&i(o,"src",n),M&1&&a!==(a=h[0].song?.name)&&i(o,"alt",a),M&1&&f!==(f=h[0].song?.name+"")&&be(m,f),M&1&&J!==(J=h[0].song?.artists[0].name+"")&&be(me,J),M&1){E=Array(h[0]?.analysis?.sections?.length);let _;for(_=0;_<E.length;_+=1){const $e=je(h,E,_);w[_]?w[_].p($e,M):(w[_]=Be($e),w[_].c(),w[_].m(F,null))}for(;_<w.length;_+=1)w[_].d(1);w.length=E.length}M&1&&g(V,"background-color",h[0].colors?.LightMuted.hex),M&1&&g(S,"background-color",h[0].colors?.Muted.hex),M&1&&g(T,"background-color",h[0].colors?.DarkMuted.hex),M&1&&g(H,"background-color",h[0].colors?.LightVibrant.hex),M&1&&g(R,"background-color",h[0].colors?.Vibrant.hex),M&1&&g(U,"background-color",h[0].colors?.DarkVibrant.hex)},i:y,o:y,d(h){h&&p(t),it(w,h)}}}function Rt(e){let t;return{c(){t=d("div"),t.innerHTML='<h1 class="svelte-bn9rh4">One sec</h1>',i(t,"class","prompt svelte-bn9rh4")},m(s,o){v(s,t,o)},p:y,i:y,o:y,d(s){s&&p(t)}}}function Be(e){let t,s,o;return{c(){t=d("div"),s=d("div"),o=b(),i(s,"class","progress svelte-bn9rh4"),g(s,"background-color",e[0].colors?.LightVibrant.hex),g(s,"width",(e[0].elapsed>e[0].analysis?.sections[e[3]].start?(e[0].elapsed-e[0].analysis?.sections[e[3]].start)/e[0].analysis?.sections[e[3]].duration*100:0)+"%"),i(t,"class","progress-chapter svelte-bn9rh4"),g(t,"height",-1/e[0].analysis?.sections[e[3]].loudness*20+"px"),g(t,"background-color",e[0].colors?.DarkMuted.hex),g(t,"width",e[0]?.analysis?.sections[e[3]].duration/e[0]?.song?.duration_ms*1e5+"%")},m(n,a){v(n,t,a),u(t,s),u(t,o)},p(n,a){a&1&&g(s,"background-color",n[0].colors?.LightVibrant.hex),a&1&&g(s,"width",(n[0].elapsed>n[0].analysis?.sections[n[3]].start?(n[0].elapsed-n[0].analysis?.sections[n[3]].start)/n[0].analysis?.sections[n[3]].duration*100:0)+"%"),a&1&&g(t,"height",-1/n[0].analysis?.sections[n[3]].loudness*20+"px"),a&1&&g(t,"background-color",n[0].colors?.DarkMuted.hex),a&1&&g(t,"width",n[0]?.analysis?.sections[n[3]].duration/n[0]?.song?.duration_ms*1e5+"%")},d(n){n&&p(t)}}}function Ut(e){let t,s,o,n;const a=[Rt,Ht,Tt],l=[];function c(r,f){return r[0]?.user==null?0:r[0].playback?.is_playing?1:2}return s=c(e),o=l[s]=a[s](e),{c(){t=d("section"),o.c(),i(t,"class","svelte-bn9rh4")},m(r,f){v(r,t,f),l[s].m(t,null),n=!0},p(r,[f]){let m=s;s=c(r),s===m?l[s].p(r,f):(He(),P(l[m],1,1,()=>{l[m]=null}),Re(),o=l[s],o?o.p(r,f):(o=l[s]=a[s](r),o.c()),D(o,1),o.m(t,null))},i(r){n||(D(o),n=!0)},o(r){P(o),n=!1},d(r){r&&p(t),l[s].d()}}}function Et(e,t,s){let o;return ne(e,A,n=>s(0,o=n)),[o]}class zt extends z{constructor(t){super();O(this,t,Et,Ut,G,{})}}function Ot(e){let t,s,o;return{c(){t=d("h1"),t.textContent="Logging you in ...",s=b(),o=d("p"),o.textContent="Please wait ...",i(t,"class","svelte-1f15kh1")},m(n,a){v(n,t,a),v(n,s,a),v(n,o,a)},p:y,i:y,o:y,d(n){n&&p(t),n&&p(s),n&&p(o)}}}function Gt(e){let t,s,o,n;return o=new At({props:{type:"primary",action:Mt,text:"Log in with Spotify"}}),{c(){t=d("h1"),t.textContent=`${qt()}`,s=b(),N(o.$$.fragment),i(t,"class","fat svelte-1f15kh1")},m(a,l){v(a,t,l),v(a,s,l),W(o,a,l),n=!0},p:y,i(a){n||(D(o.$$.fragment,a),n=!0)},o(a){P(o.$$.fragment,a),n=!1},d(a){a&&p(t),a&&p(s),j(o,a)}}}function It(e){let t,s,o,n,a,l;const c=[Gt,Ot],r=[];function f(m,L){return 0}return n=f(),a=r[n]=c[n](e),{c(){t=d("main"),s=d("div"),o=d("div"),a.c(),i(o,"class","prompt svelte-1f15kh1"),i(s,"class","prompt-wrapper svelte-1f15kh1"),i(t,"class","svelte-1f15kh1")},m(m,L){v(m,t,L),u(t,s),u(s,o),r[n].m(o,null),l=!0},p(m,[L]){a.p(m,L)},i(m){l||(D(a),l=!0)},o(m){P(a),l=!1},d(m){m&&p(t),r[n].d()}}}function qt(){const e=Ft(),t=["Howdy","Hi","Sup","Hello","Hey","Hey there","Hi there"],s=["DJ","rockstar"],o=["!",""];var n=t[Math.floor(Math.random()*t.length)];Math.random()<.5&&(n=e[Math.floor(Math.random()*e.length)]);var a=s[Math.floor(Math.random()*s.length)],l=o[Math.floor(Math.random()*o.length)];return n+", "+a+l}function Ft(){var e=new Date().getHours();return e<12?["Morning","Mornin'","Good morning","Good mornin'"]:e<18?["Afternoon"]:["Evening","Evenin'"]}function Nt(e){return pe(async()=>{We()&&Lt()}),[]}class Wt extends z{constructor(t){super();O(this,t,Nt,It,G,{})}}function jt(e){let t,s;return t=new Wt({}),{c(){N(t.$$.fragment)},m(o,n){W(t,o,n),s=!0},i(o){s||(D(t.$$.fragment,o),s=!0)},o(o){P(t.$$.fragment,o),s=!1},d(o){j(t,o)}}}function Bt(e){let t,s,o,n,a,l;return s=new zt({}),a=new kt({}),{c(){t=d("div"),N(s.$$.fragment),o=b(),n=d("div"),N(a.$$.fragment),i(t,"id","overlay"),i(t,"class","svelte-199rh4a"),i(n,"id","visualiser"),i(n,"class","svelte-199rh4a")},m(c,r){v(c,t,r),W(s,t,null),v(c,o,r),v(c,n,r),W(a,n,null),l=!0},i(c){l||(D(s.$$.fragment,c),D(a.$$.fragment,c),l=!0)},o(c){P(s.$$.fragment,c),P(a.$$.fragment,c),l=!1},d(c){c&&p(t),j(s),c&&p(o),c&&p(n),j(a)}}}function Ct(e){let t,s,o,n,a;const l=[Bt,jt],c=[];function r(f,m){return f[1]?0:1}return s=r(e),o=c[s]=l[s](e),{c(){t=d("main"),o.c(),i(t,"style",n="background: "+e[0].colors?.DarkMuted.hex+";"),i(t,"class","svelte-199rh4a")},m(f,m){v(f,t,m),c[s].m(t,null),a=!0},p(f,[m]){let L=s;s=r(f),s!==L&&(He(),P(c[L],1,1,()=>{c[L]=null}),Re(),o=c[s],o||(o=c[s]=l[s](f),o.c()),D(o,1),o.m(t,null)),(!a||m&1&&n!==(n="background: "+f[0].colors?.DarkMuted.hex+";"))&&i(t,"style",n)},i(f){a||(D(o),a=!0)},o(f){P(o),a=!1},d(f){f&&p(t),c[s].d()}}}function Yt(e,t,s){let o,n;return ne(e,A,a=>s(0,o=a)),ne(e,ae,a=>s(1,n=a)),pe(async()=>{setInterval(async()=>await ut(),1)}),[o,n]}class Jt extends z{constructor(t){super();O(this,t,Yt,Ct,G,{})}}new Jt({target:document.body,props:{name:"spotivibe"}});
